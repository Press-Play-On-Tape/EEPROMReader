#include <Sprites.h>
#include <Print.h>
#include "Font4x6.h"

#define FONT4x6_WIDTH 4
#define FONT4x6_HEIGHT 7

#define CHAR_EXCLAMATION 33
#define CHAR_PERIOD 46
#define CHAR_LETTER_A 65
#define CHAR_LETTER_Z 90
#define CHAR_LETTER_A_LOWER 97
#define CHAR_LETTER_Z_LOWER 122
#define CHAR_NUMBER_0 48
#define CHAR_NUMBER_9 57

#ifdef USE_LOWER_CASE
  #define FONT_EXCLAMATION_INDEX 62
  #define FONT_PERIOD_INDEX 63
  #define FONT_NUMBER_INDEX 52
#else
  #define FONT_EXCLAMATION_INDEX 36
  #define FONT_PERIOD_INDEX 37
  #define FONT_NUMBER_INDEX 26
#endif

const uint8_t PROGMEM font_images[] = {
4, 8,
0x00,	0x00,	0x00,	0x00,	//00
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	

0x00,	0x00,	0x00,	0x00,	//05
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	

0x00,	0x00,	0x00,	0x00,	//10
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	

0x00,	0x00,	0x00,	0x00,	//15
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	

0x00,	0x00,	0x00,	0x00,	//20
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	

0x00,	0x00,	0x00,	0x00,	//25
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	

0x00,	0x00,	0x00,	0x00,	//30
0x00,	0x00,	0x00,	0x00,	
0x00,	0x00,	0x00,	0x00,	//   Space
0x00,	0x2F,	0x00,	0x00, //   !
0x03,	0x00,	0x03,	0x00,	//   "	

0x0A,	0x1F,	0x0A,	0x1F, //35 #
0x04,	0x2A,	0x3F,	0x3A,	//   $	
0x22,	0x18,	0x06,	0x11,	//   %
0x16,	0x29,	0x17,	0x28,	//   &
0x00,	0x03,	0x00,	0x00,	//   '

0x00,	0x1E,	0x21,	0x00,	//40 (
0x00,	0x21,	0x1E,	0x00,	//   )
0x05,	0x02,	0x05,	0x00,	//   *
0x08,	0x1C,	0x08,	0x00,	//   +
0x00,	0x20,	0x10,	0x00,	//   ,

0x08,	0x08,	0x08,	0x08,	//45 -
0x00,	0x20,	0x00,	0x00,	//   .
0x20,	0x18,	0x06,	0x01,	//   /

0x1E,	0x29,	0x25,	0x1E,	//48 0
0x22,	0x3F,	0x20,	0x00,	
0x32,	0x29,	0x29,	0x26,	
0x12,	0x21,	0x25,	0x1A,	
0x0C,	0x0A,	0x3F,	0x08,	
0x17,	0x25,	0x25,	0x19,	
0x1E,	0x25,	0x25,	0x18,	
0x01,	0x39,	0x05,	0x03,	
0x1A,	0x25,	0x25,	0x1A,	
0x06,	0x29,	0x29,	0x1E,	//57 9

0x00,	0x14,	0x00,	0x00,	//58 :
0x20,	0x14,	0x00,	0x00,	//   ;
0x08,	0x14,	0x22,	0x00,	//   <
0x14,	0x14,	0x14,	0x14,	//   =
0x22,	0x14,	0x08,	0x00,	//   >
0x02,	0x29,	0x05,	0x02,	//   ?
0x1E,	0x21,	0x2D,	0x2E, //   @

0x3E,	0x09,	0x09,	0x3E,	// A
0x3F,	0x25,	0x25,	0x1A,	
0x1E,	0x21,	0x21,	0x12,	
0x3F,	0x21,	0x21,	0x1E,		
0x3F,	0x25,	0x25,	0x21,	
0x3F,	0x05,	0x05,	0x01,	
0x1E,	0x21,	0x29,	0x3A,		
0x3F,	0x04,	0x04,	0x3F,	
0x21,	0x3F,	0x21,	0x00,	
0x10,	0x21,	0x21,	0x1F,	
0x3F,	0x04,	0x0A,	0x31,		
0x3F,	0x20,	0x20,	0x20,	
0x3F,	0x02,	0x02,	0x3F,	
0x3F,	0x02,	0x04,	0x3F,	
0x1E,	0x21,	0x21,	0x1E,	
0x3F,	0x09,	0x09,	0x06,		
0x1E,	0x21,	0x11,	0x2E,	
0x3F,	0x09,	0x09,	0x36,	
0x22,	0x25,	0x25,	0x19,	
0x01,	0x3F,	0x01,	0x01,	
0x1F,	0x20,	0x20,	0x1F,	
0x0F,	0x10,	0x20,	0x1F,	
0x3F,	0x10,	0x10,	0x3F,		
0x3B,	0x04,	0x04,	0x3B,		
0x03,	0x04,	0x38,	0x07,	
0x31,	0x2D,	0x23,	0x21, // Z

0x3F,	0x21,	0x00,	0x00,	//91 [	
0x01,	0x06,	0x18,	0x20,	//   Back slash
0x01,	0x3F,	0x00,	0x00,	//   ]	
0x02,	0x01,	0x02,	0x00,	//   ^	
0x20,	0x20,	0x20,	0x20,	//   _	
0x00,	0x01,	0x02,	0x00, //   `

0x10,	0x2A,	0x2A,	0x3C,	//a
0x3F,	0x24,	0x24,	0x18,	
0x1C,	0x22,	0x22,	0x14,	
0x18,	0x24,	0x24,	0x3F,	
0x1C,	0x2A,	0x2A,	0x2C,	
0x04,	0x7E,	0x05,	0x01,	
0x4C,	0x52,	0x52,	0x3E,	
0x3F,	0x04,	0x04,	0x38,	
0x24,	0x3D,	0x20,	0x00,	
0x40,	0x40,	0x44,	0x3D,	
0x3F,	0x08,	0x14,	0x22,	
0x21,	0x3F,	0x20,	0x00,	
0x3E,	0x04,	0x04,	0x3E,	
0x3E,	0x04,	0x02,	0x3C,	
0x1C,	0x22,	0x22,	0x1C,	
0x7E,	0x22,	0x22,	0x1C,	
0x1C,	0x22,	0x22,	0x7E,	
0x3E,	0x04,	0x02,	0x04,	
0x24,	0x2A,	0x2A,	0x12,	
0x02,	0x1F,	0x22,	0x20,	
0x1E,	0x20,	0x20,	0x1E,	
0x0E,	0x10,	0x20,	0x1E,	
0x3E,	0x10,	0x10,	0x3E,	
0x36,	0x08,	0x08,	0x36,	
0x4E,	0x50,	0x50,	0x3E,	
0x32,	0x2A,	0x26,	0x22, //z

0x08,	0x16,	0x21,	0x00,	//123 {
0x00,	0x3F,	0x00,	0x00,	//    |
0x21,	0x16,	0x08,	0x00,	//    }
0x02,	0x01,	0x02,	0x01,	//    ~
0x00,	0x00,	0x00,	0x00, //    DEL
};


Font4x6::Font4x6(uint8_t lineSpacing) {

  _lineHeight = lineSpacing;
  _letterSpacing = 1;

  _cursorX = _cursorY = _baseX = 0;
  _textColor = 1;

}

size_t Font4x6::write(uint8_t c) {

  if (c == '\n')      { _cursorX = _baseX; _cursorY += _lineHeight; }
  else {

    printChar(c, _cursorX, _cursorY);
    _cursorX += FONT4x6_WIDTH + _letterSpacing;

  }

  return 1;

}

void Font4x6::printChar(const char c, const int8_t x, int8_t y) {

  ++y;

  if (c > 0) {
    
    if (_textColor == WHITE) {
      Sprites::drawSelfMasked(x, y, font_images, c);
    }
    else {
      Sprites::drawErase(x, y, font_images, c);
    }

  }

}

void Font4x6::setCursor(const int8_t x, const int8_t y) {
  _cursorX = _baseX = x;
  _cursorY = y;
}

void Font4x6::setTextColor(const uint8_t color){
  _textColor = color;
}

void Font4x6::setHeight(const uint8_t color){
  _lineHeight = color;
}
